#mode:
#  type: Cluster
#  repository:
#    type: ZooKeeper
#    props:
#      namespace: governance
#      server-lists: localhost:2181
#      retryIntervalMilliseconds: 500
#      timeToLiveSeconds: 60

dataSources:
  ts_db_0:
    dataSourceClassName: com.zaxxer.hikari.HikariDataSource
    driverClassName: com.mysql.cj.jdbc.Driver
    jdbcUrl: jdbc:mysql://localhost:3306/ts_db_0?serverTimezone=Asia/Shanghai
    password: root
    username: root
  ts_db_1:
    dataSourceClassName: com.zaxxer.hikari.HikariDataSource
    driverClassName: com.mysql.cj.jdbc.Driver
    jdbcUrl: jdbc:mysql://localhost:3306/ts_db_1?serverTimezone=Asia/Shanghai
    password: root
    username: root

rules:
  - !SHARDING
    tables:
      ts_tab:
        actualDataNodes: ts_db_${0..1}.ts_tab_${0..1}
        tableStrategy:
          standard:
            shardingColumn: id
            shardingAlgorithmName: ts_tab_inline
        keyGenerateStrategy:
          column: id
          keyGeneratorName: snowflake
        auditStrategy:
          auditorNames:
            - sharding_key_required_auditor
          allowHintDisable: true
    defaultShardingColumn: id
    defaultDatabaseStrategy:
      standard:
        shardingColumn: user_id
        shardingAlgorithmName: database_inline

    shardingAlgorithms:
      database_inline:
        type: INLINE
        props:
          algorithm-expression: ts_db_${user_id % 2}
      ts_tab_inline:
        type: INLINE
        props:
          algorithm-expression: ts_tab_${id % 2}
    keyGenerators:
      snowflake:
        type: SNOWFLAKE
    auditors:
      sharding_key_required_auditor:
        type: DML_SHARDING_CONDITIONS

props:
  sql-show: true




